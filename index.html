<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¹Ø§Ø±Ø¶ ØµÙˆØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root {
            --primary-color: #6366f1;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --whatsapp-color: #25d366;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-muted: #9ca3af;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            display: flex;
            justify-content: center;
            padding: 5px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­ÙˆØ§Ù Ù„Ø£Ù‚ØµÙ‰ Ø¯Ø±Ø¬Ø© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 98vh; /* Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø®Ø±ÙˆØ¬ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø¹Ù† Ø§Ù„Ø´Ø§Ø´Ø© */
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 12px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .content {
            padding: 10px;
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø± */
        }

        .form-group {
            margin-bottom: 8px;
        }

        label {
            display: block;
            margin-bottom: 4px;
            font-weight: bold;
            font-size: 0.8rem;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-sizing: border-box;
            outline: none;
            font-size: 16px; /* Ù„Ù…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙˆÙ… ÙÙŠ Ù‡ÙˆØ§ØªÙ iPhone */
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.95rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-add { background-color: var(--success-color); color: white; }
        .btn-delete { background-color: var(--danger-color); color: white; display: none; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-whatsapp { background-color: var(--whatsapp-color); color: white; display: none; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ù„ØµÙˆØ± Ø§Ù„Ø·ÙˆÙŠÙ„Ø© */
        #viewer-area {
            margin-top: 5px;
            border: 2px dashed #e5e7eb;
            border-radius: 10px;
            background: #fafafa;
            padding: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #main-image {
            width: auto;
            max-width: 100%;
            /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ: Ø¬Ø¹Ù„ Ø£Ù‚ØµÙ‰ Ø§Ø±ØªÙØ§Ø¹ Ù„Ù„ØµÙˆØ±Ø© 50% Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„Ø´Ø§Ø´Ø© Ù„ØªØ¸Ù‡Ø± Ø§Ù„Ø£Ø²Ø±Ø§Ø± ØªØ­ØªÙ‡Ø§ */
            max-height: 45vh; 
            object-fit: contain; 
            border-radius: 5px;
            margin-bottom: 10px;
            display: none;
        }

        .placeholder-text {
            color: var(--text-muted);
            padding: 20px;
            text-align: center;
            font-size: 0.9rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 380px;
        }
    </style>
</head>
<body>

<div class="container">
    <header>ğŸ´ Ø¹Ø§Ø±Ø¶ ØµÙˆØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</header>
    
    <div class="content">
        <div class="form-group">
            <label>ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…:</label>
            <input type="text" id="search-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§..." oninput="searchCards()">
        </div>

        <div class="form-group">
            <label>ğŸ“‹ Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©:</label>
            <select id="card-selector" onchange="displaySelectedCard()">
                <option value="">-- Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø© --</option>
            </select>
        </div>

        <button class="btn btn-add" onclick="toggleModal(true)">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>

        <div id="viewer-area">
            <div id="placeholder" class="placeholder-text">Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§</div>
            <img id="main-image" src="">
            
            <button id="whatsapp-share-btn" class="btn btn-whatsapp" onclick="shareToWhatsApp()">
                <span>ğŸ“± Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨</span>
            </button>

            <button id="delete-btn" class="btn btn-delete" onclick="deleteCurrentCard()">
                <span>ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</span>
            </button>
        </div>
    </div>
</div>

<div id="add-modal" class="modal">
    <div class="modal-content">
        <h3>Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <div class="form-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</label>
            <input type="text" id="new-card-name" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‚ÙˆØ©">
        </div>
        <div class="form-group">
            <label>Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØ±Ø©:</label>
            <input type="file" id="new-card-file" accept="image/*">
        </div>
        <button class="btn btn-primary" onclick="saveNewCard()">Ø­ÙØ¸ âœ“</button>
        <button class="btn" style="background:#ddd; color: #333;" onclick="toggleModal(false)">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø£ØµÙ„ÙŠØ©
    const firebaseConfig = {
      apiKey: "AIzaSyBdlyhBw4uSTpHiKabFgVNn7p7Psl9XTwI",
      authDomain: "phone-e035a.firebaseapp.com",
      databaseURL: "https://phone-e035a-default-rtdb.firebaseio.com",
      projectId: "phone-e035a",
      storageBucket: "phone-e035a.firebasestorage.app",
      messagingSenderId: "1003778881186",
      appId: "1:1003778881186:web:30a14c67470d296ddac9fb",
      measurementId: "G-QEXDN5P6SZ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let cardsData = {};
    let currentSelectedCardName = "";
    const ADMIN_PASSWORD = "9876";

    db.ref('cards').on('value', (snap) => { 
        cardsData = snap.val() || {}; 
        updateDropdown(); 
    });

    function toggleModal(show) {
        document.getElementById('add-modal').style.display = show ? 'flex' : 'none';
    }

    function checkAuth() {
        const pass = prompt("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
        return pass === ADMIN_PASSWORD;
    }

    function saveNewCard() {
        const name = document.getElementById('new-card-name').value.trim();
        const fileInput = document.getElementById('new-card-file');
        
        if (!name || !fileInput.files[0]) { 
            alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹"); 
            return; 
        }

        if (!checkAuth()) {
            alert("âŒ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!");
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const maxWidth = 800;
                const scaleFactor = maxWidth / img.width;
                canvas.width = maxWidth; 
                canvas.height = img.height * scaleFactor;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                const compressedData = canvas.toDataURL('image/jpeg', 0.8);
                const safeName = name.replace(/[.#$[\]]/g, "");
                db.ref('cards/' + safeName).set(compressedData)
                .then(() => { 
                    updateDropdown(); 
                    toggleModal(false); 
                    alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸!"); 
                })
                .catch((err) => alert("âŒ ÙØ´Ù„: " + err.message));
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(fileInput.files[0]);
    }

    function updateDropdown() {
        const selector = document.getElementById('card-selector');
        selector.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø© --</option>';
        Object.keys(cardsData).sort().forEach(name => {
            const option = document.createElement('option');
            option.value = name; 
            option.textContent = name;
            selector.appendChild(option);
        });
    }

    function displaySelectedCard() {
        showImage(document.getElementById('card-selector').value);
    }

    function searchCards() {
        const term = document.getElementById('search-input').value.toLowerCase();
        if (term === "") return;
        const found = Object.keys(cardsData).find(name => name.toLowerCase().includes(term));
        if (found) { 
            showImage(found); 
            document.getElementById('card-selector').value = found; 
        }
    }

    function showImage(name) {
        const imgElement = document.getElementById('main-image');
        const placeholder = document.getElementById('placeholder');
        const shareBtn = document.getElementById('whatsapp-share-btn');
        const deleteBtn = document.getElementById('delete-btn');
        
        if (name && cardsData[name]) {
            currentSelectedCardName = name;
            imgElement.src = cardsData[name]; 
            imgElement.style.display = 'block'; 
            placeholder.style.display = 'none';
            shareBtn.style.display = 'flex'; 
            deleteBtn.style.display = 'flex';
        } else {
            currentSelectedCardName = "";
            imgElement.style.display = 'none'; 
            placeholder.style.display = 'block';
            placeholder.textContent = "Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§";
            shareBtn.style.display = 'none'; 
            deleteBtn.style.display = 'none';
        }
    }

    function deleteCurrentCard() {
        if (!currentSelectedCardName) return;
        if (confirm(`Ø­Ø°Ù "${currentSelectedCardName}"ØŸ`)) {
            if (checkAuth()) {
                db.ref('cards/' + currentSelectedCardName).remove()
                .then(() => {
                    alert("ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù");
                    showImage("");
                })
                .catch(err => alert("Ø®Ø·Ø£: " + err.message));
            } else {
                alert("âŒ Ø®Ø·Ø£!");
            }
        }
    }

    async function shareToWhatsApp() {
        if (!currentSelectedCardName || !cardsData[currentSelectedCardName]) return;
        try {
            const base64Data = cardsData[currentSelectedCardName];
            const response = await fetch(base64Data);
            const blob = await response.blob();
            const file = new File([blob], `${currentSelectedCardName}.jpg`, { type: 'image/jpeg' });
            if (navigator.canShare && navigator.canShare({ files: [file] })) {
                await navigator.share({ files: [file], title: currentSelectedCardName });
            } else {
                window.open(`https://wa.me/?text=${encodeURIComponent('Ø¨Ø·Ø§Ù‚Ø©: ' + currentSelectedCardName)}`, '_blank');
            }
        } catch (error) {
            alert("Ù„Ø§ ÙŠØ¯Ø¹Ù… Ù…ØªØµÙØ­Ùƒ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØµÙˆØ± Ù…Ø¨Ø§Ø´Ø±Ø©.");
        }
    }
</script>
</body>
</html>
