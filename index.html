<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø§Ø±Ø¶ ØµÙˆØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root {
            --primary-color: #6366f1;
            --success-color: #10b981;
            --whatsapp-color: #25d366;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-muted: #9ca3af;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .content {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: opacity 0.3s;
            margin-bottom: 10px;
        }

        .btn-add {
            background-color: var(--success-color);
            color: white;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-whatsapp {
            background-color: var(--whatsapp-color);
            color: white;
            display: none; /* ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø·Ø§Ù‚Ø© */
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            opacity: 0.9;
        }

        #viewer-area {
            margin-top: 20px;
            border: 2px dashed #e5e7eb;
            border-radius: 10px;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            overflow: hidden;
            background: #fafafa;
            padding: 10px;
        }

        #viewer-area img {
            max-width: 100%;
            max-height: 400px;
            display: block;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .placeholder-text {
            color: var(--text-muted);
            text-align: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
        }
    </style>
</head>
<body>

<div class="container">
    <header>ğŸ´ Ø¹Ø§Ø±Ø¶ ØµÙˆØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</header>
    
    <div class="content">
        <div class="form-group">
            <label>ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…:</label>
            <input type="text" id="search-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù‡Ù†Ø§..." oninput="searchCards()">
        </div>

        <div class="form-group">
            <label>ğŸ“‹ Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©:</label>
            <select id="card-selector" onchange="displaySelectedCard()">
                <option value="">-- Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø© --</option>
            </select>
        </div>

        <button class="btn btn-add" onclick="toggleModal(true)">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>

        <div id="viewer-area">
            <div id="placeholder" class="placeholder-text">Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø© Ù„Ø¹Ø±Ø¶ ØµÙˆØ±ØªÙ‡Ø§</div>
            <img id="main-image" src="" style="display: none;">
            
            <button id="whatsapp-share-btn" class="btn btn-whatsapp" onclick="shareToWhatsApp()">
                <span>ğŸ“± Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</span>
            </button>
        </div>
    </div>
</div>

<div id="add-modal" class="modal">
    <div class="modal-content">
        <h3>Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <div class="form-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</label>
            <input type="text" id="new-card-name" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‚ÙˆØ©">
        </div>
        <div class="form-group">
            <label>Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØ±Ø©:</label>
            <input type="file" id="new-card-file" accept="image/*">
        </div>
        <button class="btn btn-primary" onclick="saveNewCard()">Ø­ÙØ¸ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© âœ“</button>
        <button class="btn" style="background:#ddd" onclick="toggleModal(false)">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyBdlyhBw4uSTpHiKabFgVNn7p7Psl9XTwI",
      authDomain: "phone-e035a.firebaseapp.com",
      databaseURL: "https://phone-e035a-default-rtdb.firebaseio.com",
      projectId: "phone-e035a",
      storageBucket: "phone-e035a.firebasestorage.app",
      messagingSenderId: "1003778881186",
      appId: "1:1003778881186:web:30a14c67470d296ddac9fb",
      measurementId: "G-QEXDN5P6SZ"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let cardsData = {};
    let currentSelectedCardName = "";

    db.ref('cards').on('value', (snap) => { 
        cardsData = snap.val() || {}; 
        updateDropdown(); 
    });

    function toggleModal(show) {
        document.getElementById('add-modal').style.display = show ? 'flex' : 'none';
    }

    function saveNewCard() {
        const name = document.getElementById('new-card-name').value.trim();
        const fileInput = document.getElementById('new-card-file');
        if (!name || !fileInput.files[0]) { alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©"); return; }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const maxWidth = 600;
                const scaleFactor = maxWidth / img.width;
                canvas.width = maxWidth; 
                canvas.height = img.height * scaleFactor;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                const compressedData = canvas.toDataURL('image/jpeg', 0.7);
                
                db.ref('cards/' + name.replace(/[.#$[\]]/g, "")).set(compressedData)
                .then(() => { 
                    updateDropdown(); 
                    toggleModal(false); 
                    alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­!"); 
                })
                .catch((e) => alert("âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: " + e.message));
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(fileInput.files[0]);
    }

    function updateDropdown() {
        const selector = document.getElementById('card-selector');
        selector.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø© --</option>';
        Object.keys(cardsData).forEach(name => {
            const option = document.createElement('option');
            option.value = name; 
            option.textContent = name;
            selector.appendChild(option);
        });
    }

    function displaySelectedCard() {
        const name = document.getElementById('card-selector').value;
        showImage(name);
    }

    function searchCards() {
        const term = document.getElementById('search-input').value.toLowerCase();
        const found = Object.keys(cardsData).find(name => name.toLowerCase().includes(term));
        if (found && term !== "") { 
            showImage(found); 
            document.getElementById('card-selector').value = found; 
        }
    }

    function showImage(name) {
        const imgElement = document.getElementById('main-image');
        const placeholder = document.getElementById('placeholder');
        const shareBtn = document.getElementById('whatsapp-share-btn');
        
        if (name && cardsData[name]) {
            currentSelectedCardName = name;
            imgElement.src = cardsData[name]; 
            imgElement.style.display = 'block'; 
            placeholder.style.display = 'none';
            shareBtn.style.display = 'flex'; // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        } else {
            currentSelectedCardName = "";
            imgElement.style.display = 'none'; 
            placeholder.style.display = 'block';
            placeholder.textContent = name === "" ? "Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø© Ù„Ø¹Ø±Ø¶ ØµÙˆØ±ØªÙ‡Ø§" : "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©";
            shareBtn.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        }
    }

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
    function shareToWhatsApp() {
        if (!currentSelectedCardName) return;
        
        // Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        const text = `Ø´Ø§Ù‡Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: ${currentSelectedCardName}`;
        // Ø¨Ù…Ø§ Ø£Ù† Ø§Ù„ØµÙˆØ±Ø© Base64ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ ÙƒÙ…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ø¨Ø± Ø±Ø§Ø¨Ø· URL Ø¨Ø³ÙŠØ·ØŒ 
        // Ù„Ø°Ø§ Ù†Ø±Ø³Ù„ Ø§Ù„Ù†Øµ ÙˆØ§Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©ØŒ Ø£Ùˆ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø±ÙÙˆØ¹Ø§Ù‹.
        const url = window.location.href;
        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(text + " " + url)}`;
        
        window.open(whatsappUrl, '_blank');
    }
</script>
</body>
</html>
