<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø§Ø±Ø¶ ØµÙˆØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <style>
        :root {
            --primary-color: #6366f1;
            --success-color: #10b981;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-muted: #9ca3af;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .content {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: opacity 0.3s;
            margin-bottom: 10px;
        }

        .btn-add {
            background-color: var(--success-color);
            color: white;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
        }

        #viewer-area {
            margin-top: 20px;
            border: 2px dashed #e5e7eb;
            border-radius: 10px;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #fafafa;
        }

        #viewer-area img {
            max-width: 100%;
            max-height: 450px;
            display: block;
        }

        .placeholder-text {
            color: var(--text-muted);
            text-align: center;
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
        }
    </style>
</head>
<body>

<div class="container">
    <header>ğŸ´ Ø¹Ø§Ø±Ø¶ ØµÙˆØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</header>
    
    <div class="content">
        <div class="form-group">
            <label>ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…:</label>
            <input type="text" id="search-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù‡Ù†Ø§..." oninput="searchCards()">
        </div>

        <div class="form-group">
            <label>ğŸ“‹ Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©:</label>
            <select id="card-selector" onchange="displaySelectedCard()">
                <option value="">-- Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø© --</option>
            </select>
        </div>

        <button class="btn btn-add" onclick="toggleModal(true)">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>

        <div id="viewer-area">
            <div id="placeholder" class="placeholder-text">Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø© Ù„Ø¹Ø±Ø¶ ØµÙˆØ±ØªÙ‡Ø§</div>
            <img id="main-image" src="" style="display: none;">
        </div>
    </div>
</div>

<div id="add-modal" class="modal">
    <div class="modal-content">
        <h3>Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <div class="form-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</label>
            <input type="text" id="new-card-name" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù‚ÙˆØ©">
        </div>
        <div class="form-group">
            <label>Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØ±Ø©:</label>
            <input type="file" id="new-card-file" accept="image/*">
        </div>
        <button class="btn btn-primary" onclick="saveNewCard()">Ø­ÙØ¸ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© âœ“</button>
        <button class="btn" style="background:#ddd" onclick="toggleModal(false)">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<script>
    let cardsData = JSON.parse(localStorage.getItem('myCards')) || {};

    window.onload = updateDropdown;

    function toggleModal(show) {
        document.getElementById('add-modal').style.display = show ? 'flex' : 'none';
    }

    function saveNewCard() {
        const name = document.getElementById('new-card-name').value.trim();
        const fileInput = document.getElementById('new-card-file');
        
        if (!name || !fileInput.files[0]) {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©");
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            const img = new Image();
            img.onload = function() {
                // Ø¥Ù†Ø´Ø§Ø¡ Canvas Ù„ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø©
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // ØªØ­Ø¯ÙŠØ¯ Ø£Ø¨Ø¹Ø§Ø¯ Ù…Ø¹Ù‚ÙˆÙ„Ø© (Ù…Ø«Ù„Ø§Ù‹ Ø¹Ø±Ø¶ 600 Ø¨ÙƒØ³Ù„)
                const maxWidth = 600;
                const scaleFactor = maxWidth / img.width;
                canvas.width = maxWidth;
                canvas.height = img.height * scaleFactor;

                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                
                // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ ØµÙŠØºØ© Ù…Ø¶ØºÙˆØ·Ø© (Quality 0.7)
                const compressedData = canvas.toDataURL('image/jpeg', 0.7);

                try {
                    cardsData[name] = compressedData;
                    localStorage.setItem('myCards', JSON.stringify(cardsData));
                    
                    updateDropdown();
                    toggleModal(false);
                    alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­!");
                    
                    document.getElementById('new-card-name').value = '';
                    fileInput.value = '';
                } catch (error) {
                    console.error(error);
                    alert("âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ù…ØªÙ„Ø¦Ø© Ø£Ùˆ Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹.");
                }
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(fileInput.files[0]);
    }

    function updateDropdown() {
        const selector = document.getElementById('card-selector');
        selector.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø© --</option>';
        
        Object.keys(cardsData).forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            selector.appendChild(option);
        });
    }

    function displaySelectedCard() {
        const name = document.getElementById('card-selector').value;
        showImage(name);
    }

    function searchCards() {
        const term = document.getElementById('search-input').value.toLowerCase();
        const found = Object.keys(cardsData).find(name => name.toLowerCase().includes(term));
        
        if (found && term !== "") {
            showImage(found);
            document.getElementById('card-selector').value = found;
        }
    }

    function showImage(name) {
        const imgElement = document.getElementById('main-image');
        const placeholder = document.getElementById('placeholder');

        if (name && cardsData[name]) {
            imgElement.src = cardsData[name];
            imgElement.style.display = 'block';
            placeholder.style.display = 'none';
        } else {
            imgElement.style.display = 'none';
            placeholder.style.display = 'block';
            placeholder.textContent = name === "" ? "Ø§Ø®ØªØ± Ø¨Ø·Ø§Ù‚Ø© Ù„Ø¹Ø±Ø¶ ØµÙˆØ±ØªÙ‡Ø§" : "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©";
        }
    }
</script>
</body>
</html>
